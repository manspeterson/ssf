<!doctype html>
<html class="no-js" lang="">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Samtida Svensk Fotografi</title>
    <meta name="description" content="">
        <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <script type="text/javascript" src="js/instafeed.min.js"></script>
    <!-- <script type="text/javascript" src="node_modules/jquery/dist/jquery.min.js"></script> -->
    <!--<link rel="stylesheet" href="css/main.css"> -->
    <script type="text/javascript" src="//fast.fonts.net/jsapi/8b933827-7175-49ce-88bf-00a9593121b7.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <style type="text/css">
    body {
        font-family: 'Foundry Gridnik W01', 'Gridnik', sans-serif;
        margin-top: 0;
        margin-left: 0;
        margin:0;
        float:left;
    }
    
    a,
    a:visited {
        color: black;
    }
    
    nav a {
        display: inline-block;
        /*width: 33.33%;
        line-height: 37px;*/
    }

    #users a {
        width: 100%;
        font-size: 8vw;
        line-height: 1.15;
        text-decoration: none;
        cursor: pointer;
    }

    #users a.current {
        text-decoration: underline;
    }

    #users a:hover {
        text-decoration: underline;
    }

    .profile-pic-div {
        /*display: none;*/
        visibility: hidden;
        opacity: 0;
        transition-property: opacity;
        transition-duration: 100ms;
        position: absolute;
        font-size: 18px;
        /*top: 10%;*/
        /*left: 10%;*/
        width: 20%;
        z-index: -1;
    }
        


    .profile-pic {
        width: 100%;
        height: auto;
        /*max-width: 20%;
        max-height: 30%;*/
        /*position:absolute;*/
    }

    #users a:nth-child(even) .profile-pic {
        /*right: 10%;*/
    }

    #users a:hover .profile-pic-div, #users a.current .profile-pic-div {
        display: block;
        opacity: 1;
        visibility: visible;
    }
    
    #users a.current .profile-pic-div {
        z-index: -10;
    }

    
    nav {
        padding: 3%;
        padding-top: 1.8%;
        padding-left: 0;
        width: 50%;
        height: 100%;
        min-height: 80vh;
        box-sizing: border-box;
        float: left;
    }

    .profile-pic-div p {
        margin-top: 0.5%;
    }


    
    .nav-about {
        width: 10%;
        position: fixed;
        right: 0%;
        text-align: right;
        font-size: 8vw;
        padding: 3%;
        padding-top: 1.8%;
        line-height: 1.15;
        box-sizing: border-box;
    }
    
    .nav-about a {
        text-decoration: none;
    }
    
    h1,
    h3 {
        font-size: 2vw;
        line-height: 1.0;
        margin: 0;
        font-weight: normal;
    }

    footer {
        display:none;
    }
    
    h1 {
        margin: 0;
        position: fixed;
    }
    
    h1 a {
        text-decoration: none;
    }
    
    h1 a:hover, .scrolled h1 a {
        visibility: hidden;
    }

    h1 a:before {
        content: url('pil.svg');
        display: inline-block;
        transform-origin: 0 0;
        transform: scale(1.2);
        visibility: hidden;
        width: 100%;
        position: absolute;
    }
    
    h1 a:hover:before, .scrolled h1 a:before {
        visibility: visible;

    }
    
    header {
        padding: 3%;
        width: 20%;
        float: left;
        box-sizing: border-box;
    }
    
    .user {
        float: left;
        padding-top: 5%;
        padding-left: 0;
    }
    
    .userInfo {
        width: 75%;
        padding: 3%;
        float: right;
        text-align: left;
        margin-top: 0;
        padding-bottom: 15%;
        box-sizing: border-box;
        line-height: 1.5;
        /*position: absolute;*/
    }

    .userPhoto-info img {
        width: 100%;
        transform-origin: left;
        transform: translate(50%, -50%) rotate(90deg);
    }



    .userPhoto-info.back img {
        transform: translate(50%, 50%) rotate(-90deg);
    }

    .linkuser:before {
        background: url(pil.svg) no-repeat;
        background-size: 13px 10px;
        display: inline-block;
        width: 12px;
        height: 10px;
        content: "";
        transform-origin: left;
        transform: translate(50%, -50%) rotate(90deg);
    }

    .linkuser.back:before {
        transform: translate(50%, 50%) rotate(-90deg);
    }

    .info {
        font-size: 2vw;
        line-height: 1;
        width: 55vw;
        position: fixed;
        left: 21%;
        top:4%;
        display:none;
    }
    
    .userPhotos {
        width: 80%;
        display: flex;
        float: right;
        flex-wrap: wrap;
        align-items: flex-start;
    }
    
    .userPhoto img {
        width: auto;
        max-width: 100%;
        max-height: 70vh;

    }

    
    
    .userPhoto, .userPhoto-info-parent {
        flex-basis: 33.3%;
        float: left;
        box-sizing: border-box;
        flex-grow: 1;
        flex-shrink: 0;
        padding: 0% 15% 0% 0%;
        width: 1%;
    }

    .userPhoto-info-parent {
        padding-bottom: 5%;
        flex-grow: 0;
        margin-top: 15%;
    }

    .userPhoto:nth-of-type(2n+2) {
        margin-top: 30%;
    }

    .userPhoto:nth-of-type(2n+1) {
        margin-top: 15%;
    }
    /*, .userPhoto:nth-of-type(4n+2)*/
    .userPhoto-info-parent + .userPhoto, .userPhotoLink, .userPhoto:nth-of-type(3n+1) {
        flex-basis: 66.67%;
    }

  

    .userPhoto:nth-of-type(3n+2) + .userPhotoLink, .userPhoto-info-parent + .userPhoto:nth-of-type(3n+1) {
        flex-basis: 33.33%;
    }

    /*.userPhoto:nth-of-type(4n+5), .userPhotoLink*/
     .userPhoto-info-parent + .userPhoto {
        padding-left: 10%;
    }


    
    .userPhoto:nth-of-type(3n+1) {
        padding-left: 0 !important;
    }

      .beforeUserPhotoLink {
        padding-left:0;
        flex-basis: 33.33% !important;
    }

    hr {
          flex-basis: 100%;
          width: 0px; 
          height: 0px; 
          overflow: hidden;
          border:none;
          display:block;
    }
    
/*    .userPhoto:nth-child(2n+1) {
        width: 60%;

    }*/

 /*   .userPhoto-info-parent + .userPhoto {
        width: 30%;
    }*/
   /* .userPhoto-info-parent {
        width: 30% !important;
    }*/


    

    
/*    .userPhoto:nth-child(6n+1) div {
        width: 100%;
    }
    
    .userPhoto:nth-child(6n+2) div {
        width: 60%;
        margin-top: 0%;
    }
    
    .userPhoto:nth-child(6n+3) div {
        width: 30%;
        margin-left: 0%;
        margin-top: 0%;
    }
    
    .userPhoto:nth-child(6n+4) div {
        width: 55%;
        margin-left: 0%;
        margin-top: 0%;
    }
    
    .userPhoto:nth-child(6n+5) div {
        width: 40%;
        margin-left: 0%;
        margin-top: 0%;
    }
    
    .userPhoto:nth-child(6n+6) div {
        width: 55%;
        margin-left: 0%;
        margin-top: 0%;
    }

    .userPhoto div {
        margin-bottom: 20%;
    }*/

    .userFollowers {
        margin:0;
        line-height: 1.3;
        padding-bottom: 10%;
    }

    .userPhoto-info {
        width: 100% !important;
        padding: 0 !important;
        margin: 0 !important;
    }


    .link:before {
        background: url('img/handcursor.svg') no-repeat;
        background-size: 25% 25%;
        margin-top: 0.5%;
        margin-left: 0.3%;
        position: absolute;
        width: 100px;
        content: " ";
        height: 100px;
    }
    
    .linkPhoto {
        width: 75%;
        float: right;
        margin-top: -20%;
        padding-right: 10%;
        box-sizing: border-box;
    }
    
    .linkPhoto .conatiner {
        float: right;
    }
    
    .img-link {
        width: 35%;
    }
        
    #instafeed {
        float: left;
    }

    
    #linktree {
        position: fixed;
        left: 3%;
        bottom: -8.5em;
        padding-bottom: 3%;
        line-height: 2.5;
        font-size: 1vw;
        width: 15%;
        display: none;
    }

    #linktree a {
        display:block;
    }
    
    #linktree span {
        padding-left: 0;
        display: block;
    }
    
    #linktree span:first-child {
        padding-left: 0;
    }
    
    footer {
        width: 80%;
        padding: 3%;
        padding-left:0;
        box-sizing: border-box;
        float: right;
        height: 400px;
    }

    #full {
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255,255,255,0.95);
        display: none;
        cursor: zoom-out;
        -webkit-cursor: zoom-out;


    }
    #overlay {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        border: 0;

    }
    .userPhoto img, .linkPhoto img {
        cursor: zoom-in;
    }

    #overlay td {
        vertical-align: middle;
        text-align: center;
    }
    #full img {
        margin: 0 auto;
        max-width: 100%;
        height: auto;

    }

    #closeInfo {
        display:none;
    }
    </style>
</head>

<body>
    <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <header>
        <h1><a href="#" >Samtida<br/>Svensk<br/>Fotografi</a></h1></header>
    <nav id="users"></nav>
    <nav class="nav-about"><a href="#" id="info">?</a><a href="#" id="closeInfo">X</a></nav>
    <aside id="linktree"></aside>
    <main id="instafeed">
    <div class="user"><div class="userPhotos"></div>
    </main>
    <footer>
        <h3><a id="update" href="#">Laddar...</a></h3></footer>
    <div id="full">
        <table id="overlay">
          <tr>
            <td><img src="" alt="" /></td>
          </tr>
        </table>
        </div>
        <div class="info">I Samtida Svensk Fotografi försöker vi fånga tidens anda och motveka problemet med de flesta utställningars statiska innehåll. Här försöker vi koppla upp oss emot den nya verkligheten.</div>
        <script type="text/javascript">
        
        // var users = [{
        //     username: "_frida_my_",
        //     id: "178592166"
        // }, {
        //     username: "klarakassman",
        //     id: "8553215"
        // }, {
        //     username: "abcalexandra",
        //     id: "5630181"
        // }, {
        //     username: "lejonhjerta",
        //     id: "244574151"
        // }, {
        //     username: "veraedwall",
        //     id: "30101718"
        // }, {
        //     username: "beahansson",
        //     id: "7848063"
        // }, {
        //     username: "badrizia",
        //     id: "31979878"
        // }, {
        //     username: "fridavega",
        //     id: "11691495"
        // }, {
        //     username: "moasewerin",
        //     id: "3222032"
        // }];

        var users = [{
            username: "abcalexandra",
            id: "5630181"
        }, {
            username: "lejonhjerta",
            id: "244574151"
        }, {
            username: "pamelanorah",
            id: "6905343"
        }, {
            username: "babe_ebba",
            id: "32446591"
        }, {
            username: "badrizia",
            id: "31979878"
        },{
            username: "mactacky",
            id: "253666439"
        }];

        var numberOfUsers = 1;
        var userSet = {};
        userStack = [];
        usedUsers = new Set();
        var currentUser = 178592166;
        var pageUser = currentUser;
        var currentResponse = {};
        var currentTaggedUser = 0;
        var treeUsers = [];
        var userMedia = {};
        var nRequests = 0;

        function mostLiked(a, b) {
            if (a.likes.count < b.likes.count)
                return 1;
            if (a.likes.count > b.likes.count)
                return -1;
            return 0;
        }



        function shuffle(a) {
            for (let i = a.length; i; i--) {
                let j = Math.floor(Math.random() * i);
                [a[i - 1], a[j]] = [a[j], a[i - 1]];
            }
        }

        function getFollowers(id) {
            if ($('.' + id + '-followers').length > 1) {
                $('.' + id + '-followers').text($('.' + id + '-followers').first().text());
            }
            else {
                nRequests++;
                // console.log(nRequests);
                var $url = 'https://api.instagram.com/v1/users/' + id + '/?access_token=2877872.ba4c844.1f742ef3016e440aa47dab886b5a5300';
                $.ajax({
                    method: "GET",
                    url: $url,
                    dataType: "jsonp",
                    jsonp: "callback",
                    success: function(data) {
                        $('.' + id + '-followers').html(format(data.data.counts.followed_by));
                    }

                });
            }
        }

         function getFollowersProfile(id) {
            nRequests++;
            // console.log(nRequests);
            var $url = 'https://api.instagram.com/v1/users/' + id + '/?access_token=2877872.ba4c844.1f742ef3016e440aa47dab886b5a5300';
            $.ajax({
                method: "GET",
                url: $url,
                dataType: "jsonp",
                jsonp: "callback",
                success: function(data) {
                    $('#' + id + '-profile span').first().html(format(data.data.counts.followed_by) + " följare");
                }

            });
        }

        function getUserId(username) {
            nRequests++;
            // console.log(nRequests);
            var $url = 'https://api.instagram.com/v1/users/search?q=' + username + '&access_token=2877872.ba4c844.1f742ef3016e440aa47dab886b5a5300';
            $.ajax({
                method: "GET",
                url: $url,
                dataType: "jsonp",
                jsonp: "callback",
                success: function(data) {
                    // console.log(data[0].username);
                    console.log({
                        'username': data.data[0].username,
                        'id': data.data[0].id
                    });
                }

            });
        }

        function getUserFollows(id) {
            nRequests++;
            // console.log(nRequests);
            var $url = 'https://api.instagram.com/v1/users/' + id + '/follows?access_token=2877872.ba4c844.1f742ef3016e440aa47dab886b5a5300';
            $.ajax({
                method: "GET",
                url: $url,
                dataType: "jsonp",
                jsonp: "callback",
                success: function(data) {
                    // console.log(data);
                    // console.log({'username' : data.data[0].username, 'id' : data.data[0].id});
                }

            });
        }



        function getTaggedUser(id) {
            if (currentResponse.data[currentResponse.currentItem].currentTaggedUser == undefined) {
                currentResponse.data[currentResponse.currentItem].currentTaggedUser = 0;
            } 
            if ( (currentResponse.data[currentResponse.currentItem].currentTaggedUser == currentResponse.data[currentResponse.currentItem].users_in_photo.length) || (currentResponse.data[currentResponse.currentItem].users_in_photo[currentResponse.data[currentResponse.currentItem].currentTaggedUser].user.id == currentResponse.data[0].user.id )) {
                getCommentUser(0);
                return;
            }

            getPhotos(currentResponse.data[currentResponse.currentItem].users_in_photo[currentResponse.data[currentResponse.currentItem].currentTaggedUser].user.id, 'tagged');

        }
             

        function checkTaggedResponse(response) {
            if (response == false) {
                currentResponse.data[currentResponse.currentItem].currentTaggedUser++;
                getTaggedUser(0);
            } else {
                $('.userPhoto').last().addClass('userPhotoLink');
                $('.userPhoto').last().prev().addClass('beforeUserPhotoLink');
                $('.userPhotos .numLikes').last().addClass('link');
                $('.userPhotos .numLikes').last().html('<strong>@' + response.data[0].user.username + '</strong> taggades i fotot');
                getPhotos(response.data[0].user.id);
            }

        }


        function getCommentUser(id) {

            if (currentResponse.data[currentResponse.currentItem].comments.count == 0 ) {
                return getPhotos(currentResponse.data[0].user.id);
                
            }

            if (currentResponse.data[currentResponse.currentItem].currentCommentUser == undefined) {
                currentResponse.data[currentResponse.currentItem].currentCommentUser = 0;
            }
            if (currentResponse.data[currentResponse.currentItem].comments.data == undefined) {
                nRequests++;
                // console.log(nRequests);
                var $url = 'https://api.instagram.com/v1/media/' + currentResponse.data[currentResponse.currentItem].id + '/comments?access_token=2877872.ba4c844.1f742ef3016e440aa47dab886b5a5300';
                $.ajax({
                    method: "GET",
                    url: $url,
                    dataType: "jsonp",
                    jsonp: "callback",
                    success: function(response) {
                        // console.log(response.data);
                        currentResponse.data[currentResponse.currentItem].comments.data = response.data;
                        getCommentUser(0);
                        // console.log({'username' : data.data[0].username, 'id' : data.data[0].id});
                    },
                    error: function(error) {
                        console.log(error);//getCommentUser(0);
                    }

                });
                return;
            }

            if ((currentResponse.data[currentResponse.currentItem].currentCommentUser == currentResponse.data[currentResponse.currentItem].comments.data.length ) || (currentResponse.data[currentResponse.currentItem].comments.data[currentResponse.data[currentResponse.currentItem].currentCommentUser].from.id == currentResponse.data[0].user.id) ) {
                return getPhotos(currentResponse.data[0].user.id);
                
            }
            // currentResponse.currentItem++;

            getPhotos(currentResponse.data[currentResponse.currentItem].comments.data[currentResponse.data[currentResponse.currentItem].currentCommentUser].from.id, 'comment');
         
            
        }

        function checkCommentResponse(response) {
            if (response == false) {
                currentResponse.data[currentResponse.currentItem].currentCommentUser++;
                getCommentUser(0);
            } else {
                $('.userPhoto').last().addClass('userPhotoLink');
                $('.userPhoto').last().prev().addClass('beforeUserPhotoLink');
                $('.userPhotos .numLikes').last().addClass('link');
                $('.userPhotos .numLikes').last().html('<strong>@' + response.data[0].user.username + '</strong> : ' + currentResponse.data[currentResponse.currentItem].comments.data[currentResponse.data[currentResponse.currentItem].currentCommentUser].text);
                getPhotos(response.data[0].user.id);
            }
        }



        var drawUserPhotos = function(response, back = false) {
            newUser = $('<a class="linkuser"/>');
            newUser.text( '@' + response.data[0].user.username);
            if (back) newUser.addClass('back');
            newUser.attr('data-user', response.data[0].user.username);
            if ($('.linkuser').last().attr('data-user') != response.data[0].user.username) $('#linktree').append(newUser);
            // response.data.sort(mostLiked);
            // treeUsers.push(response.data[0].user);
                // $('#linktree').append('<span><a href="#" onclick="scrollTo(' + response.data[0].user.id + ')">@' + response.data[0].user.username + '</a><br/></span>');
            if ($('.userPhoto').last().children().first().hasClass('userPhoto-info')){
                $('.userPhoto').last().remove();
            }
            if (($('.userPhoto-info').last().attr('id') != response.data[0].user.id) ) {
                userStack.push(response.data[0].user.id);
                if (userStack.length != 0) usedUsers.add(response.data[0].user.id);
                // drawLinkPhoto(response);
                    var html = '<div class="user" ><div class="userInfo" id="' + response.data[0].user.id + '"><p class="userFollowers"><strong>' + response.data[0].user.username + '</strong><br/><span class="' + response.data[0].user.id + '-followers">1000</span> följare</p><img src="pil.svg"/></div><div class="userPhotos"></div</div>';
                    // userInfo = $('<div class="userPhotos"/>');
                    userPhoto = $('<div class="userPhoto-info-parent"/>');
                    userInfoContent = $('<div class="userPhoto-info"/>');
                    userInfoContent.attr('id',response.data[0].user.id);
                    if (back) {
                        userInfoContent.addClass('back');
                    }
                    userInfoContent.html('<p class="userFollowers"><strong>@' + response.data[0].user.username + '</strong><br/><span class="' + response.data[0].user.id + '-followers">1000</span> följare</p><img src="pil.svg"/>');
                    // userInfo.append(userInfoContent);
                    userPhoto.append(userInfoContent);
                // var html = '<div class="user"><div class="userInfo" id="' + response.data[0].user.id + '"></div><div class="userPhotos"></div></div>';
                // var linebreak = $('<hr/>');
                // $('.userPhotos').first().append(linebreak);
                var linebreak = $('<div class="userPhotos"/>');
                $('.user').append(linebreak);
                $('.userPhotos').last().append(userPhoto);
                getFollowers(response.data[0].user.id);
            }
        
            
            var iter = Math.min(response.data.length-1, response.currentItem + 4);
            
            for (response.currentItem ; response.currentItem <= iter ; response.currentItem++) {
                // if (response.data[response.currentItem] == undefined) {
                //     return;
                // }
                if ($('#' + response.data[response.currentItem].id).length == 1) {
                    if (response.currentItem + 1 > iter) {
                        if (userStack.length > 1){ 
                            userStack.pop();
                            $('.userPhoto').last().addClass('userPhotoLink');
                            $('.userPhoto').last().prev().addClass('beforeUserPhotoLink');
                        }
                        if (userStack.length > 1) userStack.pop();
                        // if (userStack.length > 1) userStack.pop();
                        
                        userMedia[userStack[userStack.length-1]].currentItem++;
                        return {'action' : 'goBack', 'response' : userMedia[userStack[userStack.length-1]]};
                    } else {
                        response.currentItem++;
                    }
                }
                var div = $('<div class="userPhoto"><div class="userPhoto-' + response.currentItem + '"  id="' + response.data[response.currentItem].id + '"><p class="numLikes">' + format(response.data[response.currentItem].likes.count) + ' gillar</p></div></div>');
                var img = $('<img class="img-' + response.currentItem + '"/>');
                img.attr('src',response.data[response.currentItem].images.standard_resolution.url);
               
                // $('#' + response.data[0].user.id + '+ .userPhotos').append(div);
                $('.userPhotos').last().append(div);
                $('#' + response.data[response.currentItem].id).prepend(img);
                if (response.currentItem == iter ){
                    // getFollowers(response.data[0].user.id);
                    // response.currentItem++;
                    // console.log(response.data);

                    if ( Math.random() < 0.333){
                        if (userStack.length > 1) {
                            userStack.pop();
                            $('.userPhoto').last().addClass('userPhotoLink');
                            $('.userPhoto').last().prev().addClass('beforeUserPhotoLink');
                        }
                        if (userStack.length > 1) userStack.pop();
                        if (userStack.length > 1) userStack.pop();
                        
                        return {'action' : 'goBack', 'response' : userMedia[userStack[userStack.length-1]]};
                    } else if (!(response.data[response.currentItem].users_in_photo.length == undefined)) {
                        return {'action' : 'getTagged', 'id' : response.data[response.currentItem].id};
                    } else if (!(response.data[response.currentItem].comments.count == 0)) {
                        return {'action' : 'getComment', 'id' : response.data[response.currentItem].id};
                    // } else if (response.currentItem == 20 / userStack.length  || Math.random() < 0.667) {
                        
                    } else {
                        response.currentItem++;
                        return drawUserPhotos(response);
                    }

                }
            }
            
        }

        var drawLinkPhoto = function(response) {

            var html = '<div class="linkPhoto" id="' + response.data[0].user.id + '"><div class="container"><p class="userName">' + response.data[0].user.username + '<br/>1000 följare</p><img src="pil.svg" class="img-link"></div></div>';

            $('.user').last().append(html);
            // document.getElementById('instafeed').innerHTML += html;
        }

        var unDrawLastLinkPhoto = function() {
            var lp = $('.linkPhoto');
            if (lp[lp.length - 1].getAttribute('id') == currentUser) {

                lp[lp.length - 1].remove();
                numberOfUsers--;
            }
        }

        function stepBack() {

            var linkPhoto = getLinkPhoto(currentResponse);
            if (numberOfUsers <= 8) {
                if (linkPhoto) {
                   
                    drawLinkPhoto(linkPhoto);
                    var nextUser = linkPhoto.users_in_photo[currentTaggedUser].user.id;
                    setTimeout(getPhotos(nextUser), 200);
                } else {
                    console.log('feeel');
                }
            }
        }
        var getLinkPhoto = function(response) {
            shuffle(response.data);
            for (x in response.data) {
                var tagged = response.data[x].users_in_photo;
                if (tagged.length != 0) {
                    currentTaggedUser = Math.floor(Math.random() * (response.data[x].users_in_photo.length - 0));
                    if (tagged[currentTaggedUser].user.id in userSet) continue;
                    // console.log(response.data[x]);
                    console.log(response.data[x].users_in_photo[currentTaggedUser].user.username);
                    numberOfUsers++;
                    return response.data[x];
                    // return tagged[0].user.id;
                }
            }

            return false;
        }


        function drawNextPhotos(response, back = false) {
            // console.log(response);

            if ((response == false) || (nRequests > 300) || ($('#linktree a').length > 16)) {
                console.log('Private Profile probably')
                //Go back to previous and continue or something similar
                return;
            }

            next = drawUserPhotos(response, back);
            if (next == undefined){
                return;
            }
            console.log(numberOfUsers);

            if (next.action == 'goBack'){
                return drawNextPhotos(next.response,true);

            }

            // $('.userPhotos .numLikes').last().html(respone.data[i].users_in_photo[0].username + ' taggades i fotot');
            currentUser = response.data[0].user.id;
            currentResponse = userMedia[response.data[0].user.id];
            if (userStack.length <= 12) {
             

                if (next.action == 'getTagged') {
                    getTaggedUser(next.id);
                }
                else if (next.action == 'getComment') {
                    getCommentUser(next.id);
                }

                else {
                    drawNextPhotos(currentResponse);
                }

            }
        }

        var getPhotos = function(user_id, action = false) {
            userSet[user_id] = true;
            if (userMedia[user_id] == undefined) {
                nRequests++;
                console.log(nRequests);
                var $url = 'https://api.instagram.com/v1/users/' + user_id + '/media/recent?access_token=2877872.ba4c844.1f742ef3016e440aa47dab886b5a5300&count=30';
                $.ajax({
                    method: "GET",
                    url: $url,
                    dataType: "jsonp",
                    jsonp: "callback",
                    success: function(response) {
                        response.currentItem = 0;
                        console.log(action);
                        console.log(response);
                        if (response.data == undefined) {
                            if (!action) {
                                drawNextPhotos(false);
                            } else if (action == 'tagged') { 
                                checkTaggedResponse(false);
                            } else if (action == 'comment') {
                                checkCommentResponse(false);
                            }

                        } else {
                            shuffle(response.data);
                            // console.log('Log response.data[0]:');
                            // console.log(response.data[0]);

                            userMedia[response.data[0].user.id] = response;
                            if (!action) {
                                drawNextPhotos(response);
                            } else if (action == 'tagged') { 
                                checkTaggedResponse(response);
                            } else if (action == 'comment') {
                                checkCommentResponse(response);
                            }
                        }
                    },
                    error: function(errorCode) {
                        console.log('ERROR: ' + errorCode);
                        console.log(numberOfUsers);
                        if (errorCode.code == 429) {
                           try {
                                window.stop();
                            } catch (exception) {
                                document.execCommand('Stop');
                            }
                        }
                        // unDrawLastLinkPhoto();
                        // stepBack();
                        if (!action) {
                            drawNextPhotos(false);
                        } else if (action == 'tagged') { 
                            checkTaggedResponse(false);
                        } else if (action == 'comment') {
                            checkCommentResponse(false);
                        }
                    }
                });
            } else {  
                if (!action) {
                    drawNextPhotos(userMedia[user_id]);
                } else if (action == 'tagged') { 
                    checkTaggedResponse(userMedia[user_id]);
                } else if (action == 'comment') {
                    checkCommentResponse(userMedia[user_id]);
                }
            }
        }

        function getUserPhotos(id) {
            try {
                window.stop();
            } catch (exception) {
                document.execCommand('Stop');
            }
            $('#update').html('Laddar...');
            setTimeout(function(){
               
                pageUser = id;
                $('#users a').removeClass('current');
                $('#users a[data-id=' + id +']').addClass('current');
                numberOfUsers = 1;
                userSet = {};
                userStack = [];
                usedUsers = new Set();
                $('.userPhotos').html('');
                $('#linktree').html('');
                getPhotos(id);
                setTimeout(scrollTo,1500);
                setTimeout(ready,2000);
            }, 700);
        }

        function ready(){
            $('#update').html('Uppdatera');
        }

        function scrollTo(id) {
            if (id == 'top') {
                $('html, body').animate({
                    scrollTop: 0
                }, 1000);
            } else if (id == undefined) {
                $('html, body').animate({
                    scrollTop: $('#instafeed').first().offset().top
                }, 1000);
            } else {
                $('html, body').animate({
                    scrollTop: $('#' + id).offset().top
                }, 1000);
            }
        }

        function update() {
            $('#update').html('Laddar...');
            scrollTo('top');
            setTimeout(updateGetNew, 1000);
        }
        function updateGetNew(){
            getUserPhotos($('.userPhoto-info').first().attr('id'));
        }

        function openSlide(photo) {
            $('#full img').attr('src', photo.attr('src'));
            $('#full').fadeIn(250);
        }

        function format(num){
            var n = num.toString(), p = n.indexOf('.');
            return n.replace(/\d(?=(?:\d{3})+(?:\.|$))/g, function($0, i){
                return p<0 || i<p ? ($0+' ') : $0;
            });
        }


        // getPhotos(currentUser);
        for (x in users) {
            var a = $('<a />');
            a.attr('data-id', users[x].id);
            // a.attr('href', '');
            a.text('@' + users[x].username);
            var div = $('<div class="profile-pic-div"/>');
            var img = $('<img class="profile-pic"/>');
            img.attr('src', 'img/' + users[x].username.replace('_','') + '.jpg');
            if (x % 2 === 0){
                div.css('right', 10+x*3 + '%');
                div.css('bottom', 10+x*5 + '%');
            }
            else {
                 div.css('left', 10+x*2 + '%');
                div.css('top', 15+x*5 + '%');
            } 
            var p = $('<p class="followers" id="' + users[x].id + '-profile"><span class="profile-followers"/></p>');
            img.appendTo(div);
            p.appendTo(div);
            div.appendTo(a);
            $('#users').append(a);

            getFollowersProfile(users[x].id);
        }

       

        $('main').on('click', 'img', function() {
                    openSlide($(this));
                });
        $('h1 a').first().on('click', function(e){
            e.preventDefault();
            scrollTo('top');
        });
        $('#info').on('click', toggleInfo);
        $('#closeInfo').on('click', toggleInfo);

        function toggleInfo(e) {
            e.preventDefault();
            $('.nav-about a').fadeToggle(200);
            $('.info').fadeToggle(200);
            $('#users').fadeToggle(200);
            $('#instafeed').fadeToggle(200);
        }


        $('#users a').on('click',function(e){
            e.preventDefault();
            $('footer').show();
            getUserPhotos($(this).attr('data-id'));
        });

        $('#update').on('click', function(e){
            e.preventDefault();
            update();
        });

        $(function(){
            $('#full').click(function(){
                $(this).fadeOut();
            });

        });
       
       $(window).on('load',function(e){
            $('#update').html('Uppdatera');
       });

      // Hide Header on on scroll down
            var didScroll;
            var lastScrollTop = 0;
            var delta = 5;
            var navbarHeight = 0;
            
            $(window).scroll(function(event){
                didScroll = true;
            });
            
            setInterval(function() {
                if (didScroll) {
                    hasScrolled();
                    didScroll = false;
                }
            }, 250);
            
            function hasScrolled() {
                var st = $(this).scrollTop();
                
                // Make sure they scroll more than delta
                if(Math.abs(lastScrollTop - st) <= delta){
                    
                    lastScrollTop = st;
                    return;
                }
                // If they scrolled down and are past the navbar, add class .nav-up.
                // This is necessary so you never see what is "behind" the navbar.
                if ( st > navbarHeight){
                    // Scroll Down
                    $('header').first().addClass('scrolled');

                    // $('.bottom').removeClass('nav-up');
                } else {
                    // Scroll Up
                    $('header').first().removeClass('scrolled');
                    // if (lastScrollTop - st > 0){
                    // //if(st + $(window).height() < $(document).height()) {
                    //     // $('.top').removeClass('nav-down');
                    //     // $('.bottom').addClass('nav-up');
                        
                    // }
                }
                lastScrollTop = st;
            }


        </script>
</body>

</html>
